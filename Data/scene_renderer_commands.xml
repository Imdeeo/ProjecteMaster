<?xml version="1.0" encoding="ISO-8859-1"?>
<scene_renderer_commands>
	<set_light_constants/>
	
	<set_pool_renderable_objects_technique pool="generate_shadowmap_pool"/>
	<generate_shadow_maps/>
	
	<set_depth_stencil_state enable_z_test="true" write_z_buffer="true"/>
	<set_matrices/>
		
	<!--FORWARD<clear render_target="true" depth_stencil="true"/>
	<set_pool_renderable_objects_technique pool="forward_shading"/>
	<render_layer layer="solid" active="true"/>-->
	
	<set_render_target name="deferred_multiple_render_target">
		<dynamic_texture name="DiffuseMapTexture" texture_width_as_frame_buffer="true" create_depth_stencil_buffer="false"/>
		<dynamic_texture name="LightMapTexture" texture_width_as_frame_buffer="true"/>
		<dynamic_texture name="NormalMapTexture" texture_width_as_frame_buffer="true"/>
		<dynamic_texture name="DepthMapTexture" texture_width_as_frame_buffer="true"/>
	</set_render_target>
	
	<clear render_target="false" depth_stencil="true"/>
	<set_pool_renderable_objects_technique pool="gBuffer"/>
	<render_layer layer="solid" active="true"/>
	<unset_render_target/>
	
	<clear render_target="true" depth_stencil="false"/>
	<set_depth_stencil_state enable_z_test="false" write_z_buffer="false"/>
	<set_pool_renderable_objects_technique pool="forward_shading"/>
	<render_draw_quad active="true">
		<texture stage_id="0" file="LightMapTexture" load_file="false"/>
	</render_draw_quad>

	<set_pool_renderable_objects_technique pool="deferred_shading_lighting"/>
	
	<render_deferred_shading>
		<texture stage_id="0" file="DiffuseMapTexture" load_file="false"/>
		<texture stage_id="1" file="LightMapTexture" load_file="false"/>
		<texture stage_id="2" file="NormalMapTexture" load_file="false"/>
		<texture stage_id="3" file="DepthMapTexture" load_file="false"/>
	</render_deferred_shading>
	
	<!--
	<set_pool_renderable_objects_technique pool="deferred_shading_lighting"/>
	<enable_alpha_blend/>
	<render_draw_quad active="true" material="FogMaterial">
		<texture stage_id="0" file="DepthMapTexture" load_file="false"/>
	</render_draw_quad>
	<disable_alpha_blend/>
	-->
	
<<<<<<< HEAD
	<!-- SKYBOX -->
	<set_depth_stencil_state enable_z_test="true" write_z_buffer="false"/>
=======
	<!--<set_depth_stencil_state enable_z_test="true" write_z_buffer="false"/>
>>>>>>> 9d83e40a84da50c53d63b69efc4eedf581c797be
	<set_pool_renderable_objects_technique pool="skybox_pool"/>
	<render_layer layer="skybox" active="true"/>-->
	
	<!-- LIGHT SCATTERING 
	<capture_frame_buffer>
		<capture_texture name="LightScatteringStart" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>
	
	<set_render_target>
		<dynamic_texture name="LightScattering" texture_width_as_frame_buffer="true" create_depth_stencil_buffer="false"/>
	</set_render_target>
	<clear render_target="true" depth_stencil="false"/>
	<render_layer layer="skybox" active="true"/>
	
	<unset_render_target/>
	
	<set_pool_renderable_objects_technique pool="blur_pool"/>
	<apply_filters>
		<texture load_file="false" file="LightScattering" stage_id="0"/>
		<dynamic_texture name="LightScattering2" width="800" height="600" material="BlurMaterial"/>
		<dynamic_texture name="LightScattering1" width="800" height="600" material="BlurMaterial"/>
		<dynamic_texture name="LightScatteringFinal" width="800" height="600" material="BlurMaterial"/>
	</apply_filters>
	
	<unset_render_target/>
	
	<set_pool_renderable_objects_technique pool="light_scattering_pool"/>
	<render_draw_quad active="true" material="LightScatteringMaterial">
		<texture stage_id="0" file="LightScatteringStart"/>
		<texture stage_id="1" file="LightScatteringFinal"/>
	</render_draw_quad>
	-->
	
	<!--
	<render_debug_grid/>
	-->
	
	<!-- ZBLUR
	<capture_frame_buffer>
		<capture_texture name="CapturedZBlurTexture" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>

	<set_pool_renderable_objects_technique pool="blur_pool"/>
	<apply_filters>
		<texture file="CapturedZBlurTexture" stage_id="0"/>
		<dynamic_texture name="StartZBlur" material="GUIMaterial" height="600" width="800"/>
		<dynamic_texture name="ZBlur3" material="BlurMaterial" height="600" width="800"/>
		<dynamic_texture name="ZBlur2" material="BlurMaterial" height="600" width="800"/>
		<dynamic_texture name="ZBlur1" material="BlurMaterial" height="600" width="800"/>
		<dynamic_texture name="ZBlur" material="BlurMaterial" height="600" width="800"/>
	</apply_filters>

	<unset_render_target/>

	<set_pool_renderable_objects_technique pool="zblur_pool"/>
	
	<render_draw_quad active="true" material="ZBlurMaterial">
		<texture load_file="false" file="CapturedZBlurTexture" stage_id="0"/>
		<texture load_file="false" file="ZBlur" stage_id="1"/>
		<texture load_file="false" file="DepthMapTexture" stage_id="2"/>
	</render_draw_quad>
	-->
	
	<!-- BLOOM
	<capture_frame_buffer>
		<capture_texture name="CapturedBloomTexture" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>
	
	<set_pool_renderable_objects_technique pool="bloom_pool"/>

	<apply_filters>
		<texture file="CapturedBloomTexture" stage_id="0"/>
		<dynamic_texture name="BloomTexture" material="BloomMaterial" height="600" width="800"/>
		<dynamic_texture name="BloomBlurTexture" material="BloomBlurMaterial" height="600" width="800"/>
	</apply_filters>

	<unset_render_target/>

	<render_draw_quad active="true" material="BloomCombineMaterial">
		<texture load_file="false" file="CapturedBloomTexture" stage_id="0"/>
		<texture load_file="false" file="BloomBlurTexture" stage_id="1"/>
	</render_draw_quad>
	-->
	
	<!-- HDAO
	<capture_frame_buffer>
		<capture_texture name="CapturedTexture" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>

	<set_pool_renderable_objects_technique pool="hdao_pool"/>
	<render_draw_quad active="true" material="HDAOMaterial">
		<texture load_file="false" file="CapturedTexture" stage_id="0"/>
		<texture load_file="false" file="NormalMapTexture" stage_id="1"/>
		<texture load_file="false" file="DepthMapTexture" stage_id="2"/>
	</render_draw_quad>
	-->

	<set_pool_renderable_objects_technique pool="forward_shading"/>
	<render_debug_lights/>
	<set_ant_tweak_bar/>	
	<present/>
</scene_renderer_commands>

